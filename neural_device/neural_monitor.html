<!DOCTYPE html>
<meta charset="utf-8">
<script>
    function sendMode(modeValue){
      if(modeValue === 'classify'){
        var patternArea = getElementById("patternArea");
        patternArea.disabled;
      }
      if(socket != null){
          socket.send(JSON.stringify([{type:"mode",value:modeValue}]));
      }
    }
    
    function sendPattern(patternValue){
       pattern = patternValue;
       if(socket != null){
           socket.send(JSON.stringify([{type:"pattern",value:patternValue}]));
       }
    }
</script>
<body>
  <h2>Neural Device</h2>
  <div id="messageArea"></div>
  <div width = "1200" align = "center" style="font-weight:bold;">
    <span id = "modeArea">
        Mode:
        <input type="radio" name="mode" value="learn" checked="checked" onclick="sendMode('learn');">Learning
        <input type="radio" name="mode" value="classify" onclick="sendMode('classify');">Classify
    </span>
    </br>
    <span id = "patternArea">
        Pattern:
        <input type="radio" name="pattern" value="soft" checked="checked" onclick="sendPattern('soft');">Soft
        <input type="radio" name="pattern" value="hard" onclick="sendPattern('hard');">Hard
    </span>
    </br>
  <span>
    <canvas id="input_scatter" width="400" height="400"></canvas>
    <canvas id="label_pattern" width="400" height="400"></canvas>
  </span>
  </div>
                            
<script src="/socket.io/socket.io.js"></script>
<script>

    // éUïzê}ÉGÉäÉAÇ∆ÉpÉ^Å[ÉìÉGÉäÉAÇÃògê¸Çï`Ç≠
    var inputArea = document.getElementById('input_scatter');
    inputAreaContext = inputArea.getContext('2d');
    inputAreaContext.rect(0, 0, 400, 400);
    inputAreaContext.stroke();
    //inputAreaContext.font = 'bold 40pt Calibri';
    //inputAreaContext.fillText("bend", 0, 390);
    //inputAreaContext.fillText("pressure", 0, 10);
    //inputAreaContext.fillText("pressure", 200, 10);
    var patternArea = document.getElementById('label_pattern');
    patternAreaContext = patternArea.getContext('2d');
    patternAreaContext.rect(0, 0, 400, 400);
    patternAreaContext.stroke();

    var messageArea = document.getElementById('messageArea');
    var pattern = "soft";
try{

var socket = io.connect('http://192.168.1.7:8124/');

socket.send(JSON.stringify([{type:"mode",value:"learn"},{type:"pattern",value:"soft"}]));

socket.on('message', onMessage);

}catch(e){
	alert(e);
}

function onMessage (message){
    try{
        var param = JSON.parse(message);
        messageArea.innerHTML = message;
        if(param.bend != undefined && param.pressure != undefined){
            drawData(param);
        }
        if(param.pattern != undefined){
            drawPattern(param.pattern);
        }
    }catch(e){
        alert(e);
    }
}

function drawData(param){
    var canvas = document.getElementById('input_scatter');
    var fontColor = null;
    if(pattern === "soft"){
        fontColor = "blue";
    } else if(pattern = "hard"){
        fontColor = "red";
    }
    
    if (canvas.getContext) {
        var context = canvas.getContext('2d');
        //ã»Ç∞Ç∆à≥óÕÇ≈éUïzê}Çï`Ç≠
        var arcX = Math.round((270 - param.bend) * (400/(270-190)));
        var arcY = 400 - Math.round(param.pressure * (400/700));
        context.beginPath();
        context.arc(arcX, arcY, 5, 0, Math.PI*2, false);
        context.fillStyle = fontColor;
        context.fill();
    }
}   

function drawPattern(pattern){
    var patternArea = document.getElementById('label_pattern');
    patternAreaContext = patternArea.getContext('2d');
    patternAreaContext.clearRect(0,0,400,400);
    for(var i = 0; i < 4; i++){
        for(var j = 0; j < 5; j++){
         var patternValue = pattern[i*5 + j];
         if(patternValue == 0.5){
            patternAreaContext.fillStyle = 'red';
         }else if(patternValue == 0.3){
            patternAreaContext.fillStyle = 'blue';
         }
         patternAreaContext.font = 'bold 20pt Calibri';
         patternAreaContext.fillText(patternValue, (j + 1) * 60, (i + 1) * 80);
        }
    }

}

</script>

</body>
</html>
